<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.4 Upgrading from Grails 3.1 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Upgrading Grails Applications
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/versions.html"><strong>1</strong><span>Comparing Versions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>2</strong><span>Upgrading</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>2.4 Upgrading from Grails 3.1</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="upgrading31x">2.4 Upgrading from Grails 3.1</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading31x.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you are upgrading from Grails 3.1 there are a few items to take into consideration.</p>
</div>
<div class="sect3">
<h4 id="_use_webpromises_instead_of_promises_in_controllers">Use WebPromises instead of Promises in Controllers</h4>
<div class="paragraph">
<p>In versions of Grails prior to 3.2, <code>grails.async.Promises</code> used to allow the use of <code>render</code> and other controller methods, however this was unsafe as the request thread may have finished prior to the task executing leading to unexpected errors.</p>
</div>
<div class="paragraph">
<p>You should now instead use <code>grails.async.web.WebPromises</code> within a controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deprecated_classes_and_methods_removed">Deprecated Classes and Methods Removed</h4>
<div class="paragraph">
<p>Classes and methods deprecated in Grails 3.0.x have been removed in Grails 3.2. This includes all classes in the <code>org.codehaus.groovy.grails</code> package. If your application or plugin uses deprecated classes they should be updated to use non-deprecated replacements.</p>
</div>
</div>
<div class="sect3">
<h4 id="_slf4j_now_default">Slf4j Now Default</h4>
<div class="paragraph">
<p>The <code>log</code> property injected at compile time into all classes is now an Slf4j <code>Logger</code> instance and not an instance of the Commons Logging <code>Log</code> class.</p>
</div>
<div class="paragraph">
<p>This should be a simple upgrade for most use cases, however this change does have some implications, for example it is no longer possible to pass non-string types to the log method. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">this works</span><span class="delimiter">&quot;</span></span>
<span class="predefined-type">Double</span> notAString = <span class="float">9.2</span>
log.info notAString</code></pre>
</div>
</div>
<div class="paragraph">
<p>The latter call to the <code>info</code> method will throw an exception as it is not a String.</p>
</div>
<div class="paragraph">
<p>Instead you should use Slf4j&#8217;s formatting anchors to log. The advantage is the <code>toString()</code> method is not called unless the message will be logged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">{}</span><span class="delimiter">&quot;</span></span>, <span class="float">9.2D</span>
log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">Key: {}, Value: {}</span><span class="delimiter">&quot;</span></span>, key, value
log.error <span class="string"><span class="delimiter">&quot;</span><span class="content">{}</span><span class="delimiter">&quot;</span></span>, exception.message, exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://www.slf4j.org/faq.html#string_or_object">Slf4j FAQ</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_4_3">Spring 4.3</h4>
<div class="paragraph">
<p>Grails 3.2 comes with Spring 4.3 which no longer supports Hibernate 3 and hence Grails 3.2 no longer supports Hibernate 3 either and you will need to upgrade to Hibernate 4 or above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_boot_1_4">Spring Boot 1.4</h4>
<div class="paragraph">
<p>Spring Boot 1.4, through its dependency management mechanism, enforces the upgrade for many dependencies. You should review your dependencies following the upgrade to ensure the new versions are compatible with your application.</p>
</div>
<div class="paragraph">
<p>Spring Boot 1.4 also deprecates many testing annotations (such as <code>WebIntegrationTest</code>).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-1.4-Release-Notes">Spring Boot 1.4 release notes</a> for more information on the changes required at the Boot level.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hibernate_4_usage">Hibernate 4 Usage</h4>
<div class="paragraph">
<p>Related to Spring Boot 1.4, one important change is that Hibernate 5 is now the default version, so if you have declared a dependency on the <code>hibernate4</code> plugin in Grails such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate4</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will not be enough to ensure that Hibernate 4 is used. You must instead also directly declare the Hibernate 4 dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate4</span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-core:4.3.10.Final</span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-ehcache:4.3.10.Final</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gorm_6_configuration_model">GORM 6 Configuration Model</h4>
<div class="paragraph">
<p>In preparation for Hibernate 5.2 support the previous "SessionFactoryBean" notion has been removed. Now if you wish to customize <code>SessionFactory</code> creation you should instead register a custom <code>org.grails.orm.hibernate.connections.HibernateConnectionSourceFactory</code> in Spring.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hibernatetestmixin_dependency_changes">HibernateTestMixin Dependency Changes</h4>
<div class="paragraph">
<p>The <code>grails-datastore-test-support</code> dependency has been removed and the <code>HibernateTestMixin</code> class integrated directly into the plugin, so if you receive a resolve error remove the following dependency from your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-datastore-test-support</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_application_groovy_code_changes"><code>application.groovy</code> Changes</h4>
<div class="paragraph">
<p>An improvement was added to make groovy configuration behave like yml configuration when it comes to the CLI. Previously, configuration values in <code>application.groovy</code> were not available to commands like <code>grails create-controller</code>. A side effect of this change causes an exception when those commands are executed if the configuration relies on classes in the runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="exception">Error</span> occurred running Grails <span class="key">CLI</span>: startup <span class="key">failed</span>:
script14738267015581837265078.groovy: <span class="integer">13</span>: unable to resolve <span class="type">class</span> <span class="class">com</span>.foo.Bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution is to create a separate file called <code>runtime.groovy</code> in <code>grails-app/conf</code>. That file will not be parsed by the CLI and will only be included at runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stop_using_the_default_namespace">Stop using the default namespace</h4>
<div class="paragraph">
<p>Using the default package in places like <code>UrlMappings.groovy</code>, <code>BootStrap.groovy</code> or in a taglib can cause that code to fail or not execute at all when packaged in a JAR or WAR file. Make sure all Groovy/Java files start with the <code>package</code> statement and move any affected files to the respective folder. For example, change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UrlMappings</span> {

    <span class="directive">static</span> mappings = {

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp

<span class="type">class</span> <span class="class">UrlMappings</span> {

    <span class="directive">static</span> mappings = {

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>and move the file from <code>grails-app/controllers/UrlMappings.groovy</code> into <code>.grails-app/controllers/myapp/UrlMappings.groovy</code></p>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
