<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.6.3 General Changes to be aware of when migrating apps 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Upgrading Grails Applications
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/versions.html"><strong>1</strong><span>Comparing Versions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>2</strong><span>Upgrading</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>2.6.3 General Changes to be aware of when migrating apps</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="upgradingGeneral">2.6.3 General Changes to be aware of when migrating apps</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading2x/upgradingGeneral.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are other miscellaneous changes between Grails 2.x and Grails 3.x that it may help to be aware of when migrating your applications and plugins. Minor changes may be required.</p>
</div>
<div class="sect3">
<h4 id="_domain_classes">Domain classes</h4>
<div class="paragraph">
<p>The <a href="#constraints">Constraints</a> section of a <a href="#GORM">Domain Class</a> (or other validateable object) looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  myField <span class="key">nullable</span>: <span class="predefined-constant">true</span>
  another <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Grails 2.x, fields with no constraints could be declared in the <a href="#constraints">Constraints</a> block, as a method call with no arguments. Example (NB. the following syntax is <strong>no longer</strong> supported):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  mySimpleProperty()                  <span class="comment">// &lt;- A field that has no constraints. This syntax is not supported in Grails 3.</span>
  anotherProperty <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A different syntax has to be used in Grails 3. Either remove the field declaration from the constraints block (if there are no constraints to specify for it), or to keep the field placeholder, pass an empty map argument: <code>\[:\]</code> instead of <code>()</code>.</p>
</div>
<div class="paragraph">
<p>Replacement code for Grails 3.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  mySimpleProperty [:]                <span class="comment">// &lt;- Empty map argument instead of ()</span>
  anotherProperty <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If such declarations have not yet been changed then a log message like this emits on startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ORM Mapping <span class="key">Invalid</span>: Specified config option &lt;&lt;mySimpleProperty&gt;&gt; does not exist <span class="keyword">for</span> <span class="type">class</span> [<span class="class">example</span>.MyDomainClass]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_project_builds_grails_2_x_inline_plugins">Multi-project builds (Grails 2.x inline plugins)</h4>
<div class="paragraph">
<p>If your project had inline plugins in Grails 2.x, contains ASTs, or if your project is composed of several modules or related applications then you may decide to restructure your project as a Gradle <strong>multi-project build</strong>.</p>
</div>
<div class="paragraph">
<p>Sample multi-project structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">+ example
    + example-app   &lt;-- Main app
    + example-core  &lt;-- Shared code plugin
    + example-ast   &lt;-- AST transformations plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>How to configure this is documented in the <a href="#plugins">Plugins</a> section under the heading 'Inline Plugins in Grails 3.0'.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_from_grails_2_x_to_grails_3_1">Migrating from Grails 2.x to Grails 3.1+</h4>
<div class="paragraph">
<p>During the progress of migrating code from Grails 2.4 to Grails 3.1+, your project (and the plugins that your project depends on) will be moving to GORM 5 (or higher) and other newer library versions. You might also wish to familiarise yourself with the differences mentioned in the section <a href="#upgrading3x">Upgrading from Grails 3.0</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ast_transformations">AST Transformations</h4>
<div class="paragraph">
<p>If your application contains AST transformations, please be aware that for these to be applied to your application code, they must now be contained <strong>within a plugin</strong>. (In Grails 2.x it was possible to pre-compile AST transformations then apply them to your application code by hooking into compile events in <code>_Events.groovy</code>. This is no longer possible. Move your AST Transformation classes and associated annotations into a plugin for this purpose.)</p>
</div>
<div class="paragraph">
<p>There are two AST patterns on which you can base migration of your AST transformer code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy way: Use Groovy AST transformation annotations.</p>
</li>
<li>
<p>Grails way: Use Grails AST transformer annotations.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_groovy_ast_transformations">Groovy AST transformations</h5>
<div class="ulist">
<ul>
<li>
<p>Import <code>org.codehaus.groovy.transform.GroovyASTTransformation</code></p>
</li>
<li>
<p>Annotate your transformation class with <code>GroovyASTTransformation(phase=CompilePhase.CANONICALIZATION)</code></p>
</li>
<li>
<p>A useful example app can be found here: <a href="#ref-comjeffbrowngrails3ast-grails3ast">grails3ast</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_grails_ast_transformations">Grails AST transformations</h5>
<div class="ulist">
<ul>
<li>
<p>Import <code>grails.compiler.ast.AstTransformer</code></p>
</li>
<li>
<p>Annotate your transformation class with <code>AstTransformer</code></p>
</li>
<li>
<p>Implement applicable interfaces, particularly if you are transforming Artefacts, e.g. <code>implements GrailsArtefactClassInjector, AnnotatedClassInjector</code></p>
</li>
<li>
<p>Your Transformer class must reside in a package under <strong>org.grails.compiler</strong>, otherwise it will not be detected. Example: <strong>org.grails.compiler.myapp</strong></p>
</li>
<li>
<p>Examples can be found in the Grails source code</p>
</li>
<li>
<p>Example reference: <a href="#ref-java-ControllerActionTransformer.java">ControllerActionTransformer.java</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deployment_to_containers">Deployment to containers</h4>
<div class="paragraph">
<p>Grails uses Spring Boot to embed a Tomcat or Jetty instance by default. To build a war file for deployment to a container you will need to make a simple change to <code>build.gradle</code> (so that a container is not embedded).</p>
</div>
<div class="paragraph">
<p>If you deploy to a Tomcat 7 container then there is an additional step. Grails 3 is built against Tomcat 8 APIs by default. You will need to change the target Tomcat version in the build to 7.</p>
</div>
<div class="paragraph">
<p>There are standalone deployment options available.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="#deployingAnApplication">Deployment guide</a> for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_datasources">Multiple datasources</h4>
<div class="paragraph">
<p>If your application uses multiple datasources, then be aware that the way these are declared in <code>application.yml</code> or <code>application.groovy</code> (previously <code>DataSources.groovy</code>) has changed.</p>
</div>
<div class="paragraph">
<p>If there is more than one DataSource in an application there is now a <code>dataSources { &#8230;&#8203; }</code> configuration block to contain them all. Previously, multiple <code>dataSource</code> declarations were used, with an underscore and suffix on the additional datasources, e.g. <code>dataSource_lookup { &#8230;&#8203; }</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the user guide section on <a href="#multipleDatasources">Multiple Datasources</a> for examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improvements_to_dependency_injection">Improvements to dependency injection</h4>
<div class="paragraph">
<p>In your Grails 2.x app you may have used Spring <code>@Autowired</code> in a few situations, such as dependency injection into certain base classes, and for typed field dependency injection. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span>
org.quartz.Scheduler quartzScheduler</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails now has support for dependency injection into typed fields in addition to untyped <code>def</code> fields, following the usual Grails conventions of field name matching the bean property name. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GrailsApplication grailsApplication</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may find that <code>@Autowired</code> no longer works as it did previously in your code on artefacts or base classes, in certain scenarios, resulting in NULL for these fields. Changing these to a simple typed Grails dependency following the Grails naming convention and removing <code>@Autowired</code> should resolve this.</p>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
