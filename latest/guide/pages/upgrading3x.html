<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.3 Upgrading from Grails 3.0 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Upgrading Grails Applications
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/versions.html"><strong>1</strong><span>Comparing Versions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>2</strong><span>Upgrading to Grails 3.3</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>2.3 Upgrading from Grails 3.0</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="upgrading3x">2.3 Upgrading from Grails 3.0</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading3x.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Generally to upgrade an application from Grails 3.0 you can simply modify the version of Grails in <code>gradle.properties</code>.</p>
</div>
<div class="paragraph">
<p>There are however some differences to Grails 3.0.x that are documented below.</p>
</div>
<div class="sect3">
<h4 id="_gorm_5_upgrade">GORM 5 Upgrade</h4>
<div class="paragraph">
<p>Grails 3.1 ships with GORM 5, which is a near complete rewrite of GORM ontop of Groovy traits and is not binary compatible with the previous version of GORM.</p>
</div>
<div class="paragraph">
<p>If you receive an error such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Caused <span class="key">by</span>: java.lang.ClassNotFoundException: org.grails.datastore.gorm.GormEntity<span class="error">$</span>Trait<span class="error">$</span>FieldHelper
    ... <span class="integer">8</span> more</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are using a plugin or class that was compiled with a previous version of GORM and these will need to be recompiled to be Grails 3.1 and GORM 5 compatible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hibernate_plugin">Hibernate Plugin</h4>
<div class="paragraph">
<p>For the GORM 5 release the <code>hibernate</code> plugin has been renamed to <code>hibernate4</code> (and there are <code>hibernate3</code> and <code>hibernate5</code> versions too). You should change your <code>build.gradle</code> to reflect that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:hibernate4</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_resources_path">Static Resources Path</h4>
<div class="paragraph">
<p>The default path for static resources resolved from <code>src/main/resources/public</code> has been changed to be nested under the <code>static/*</code> pattern instead of directly under the root of the application. For example a link in GSP pages such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>{g.resource(<span class="key">dir</span>:<span class="string"><span class="delimiter">'</span><span class="content">files</span><span class="delimiter">'</span></span>, <span class="key">file</span>:<span class="string"><span class="delimiter">'</span><span class="content">mydoc.pdf</span><span class="delimiter">'</span></span>)}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will produce a URI such as <code>/static/files/mydoc.pdf</code> instead of <code>/files/mydoc.pdf</code>. If you wish to revert to the previous behavior you can configure this in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">resources</span>:
        <span class="key">pattern</span>: <span class="string"><span class="content">'/**'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filters_plugin_removed">Filters Plugin Removed</h4>
<div class="paragraph">
<p>The Filters plugin was replaced by <a href="theWebLayer.html#interceptors">Interceptors</a> in Grails 3.0.x, although the plugin was still present. In Grails 3.1.x the Filters plugin has been removed. If you still wish to use the filters plugin you can add a dependency on the previous version provided by Grails 3.0.x. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-plugin-filters:3.0.12</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You would also need to move the filters to any other source directory (e.g. <code>grails-app/controllers</code>) as <code>grails-app/conf</code> is not considered a source directory anymore.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_transactional_proxies">Spring Transactional Proxies</h4>
<div class="paragraph">
<p>Because the <code>grails.transactional.Transactional</code> transform already provides the ability to create transactional services without the need for proxies, traditional support for transactional proxies has been disabled by default for new applications.</p>
</div>
<div class="paragraph">
<p>This means that if you have any services that use the <code>transactional</code> property and not the <code>Transactional</code> annotation they should be altered. For example the following service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">FooService</span> {
    <span class="directive">static</span> transactional = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">FooService</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition because in previous versions of a Grails <code>transactional</code> defaulted to <code>true</code> any services that do not declare <code>transactional</code> should be altered too.</p>
</div>
<div class="paragraph">
<p>If you wish to adopt the new behavior then transctional proxies can be disabled with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">spring</span>:
        <span class="key">transactionManagement</span>:
            <span class="key">proxies</span>: <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_json_converter_changes">JSON Converter changes</h4>
<div class="paragraph">
<p>The default JSON converter no longer includes the <code>class</code> property by default. This can be re-enable with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">converters</span>:
        <span class="key">domain</span>:
            <span class="key">include</span>:
                <span class="key">class</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition the default JSON converter will no longer render the <code>id</code> property if it is <code>null</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_json_builder_groovy_alignment">JSON Builder Groovy Alignment</h4>
<div class="paragraph">
<p>The class <code>grails.web.JSONBuilder</code> has been deprecated and replaced with <a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/json/StreamingJsonBuilder.html">groovy.json.StreamingJsonBuilder</a>, the default JSON builder within Groovy. This avoids confusion with the differences between JSON builders and better aligns with Groovy&#8217;s core libraries.</p>
</div>
<div class="paragraph">
<p>This also means that any <code>render</code> blocks that rendered JSON will need to be updated to use the <a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/json/StreamingJsonBuilder.html">groovy.json.StreamingJsonBuilder</a> syntax. For example the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">render(<span class="key">contentType</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>) {
    title = <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should instead be written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">render(<span class="key">contentType</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>) {
    title <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are upgrading and prefer to continue to use the previous implementation then you can re-enable the deprecated JSONBuilder with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">json</span>:
        <span class="key">legacy</span>:
            <span class="key">builder</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_json_views_replace_json_converters">JSON Views Replace JSON Converters</h4>
<div class="paragraph">
<p>With the addition of JSON views the previous API for using JSON converters is largely discouraged in favour of views. The converters plugin will in the future be separated into an external plugin and JSON views phased in to replace it. The JSON converter API is not deprecated, however JSON views provide a more fully featured, elegant API that is superior to writing JSON converters and/or marshallers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_boot_1_3_and_spring_4_2">Spring Boot 1.3 and Spring 4.2</h4>
<div class="paragraph">
<p>Grails 3.1 ships with upgraded third party libraries that may require changes. See the <a href="https://github.com/spring-projects/spring-boot/wiki/spring-boot-1.3-release-notes">Spring Boot upgrade notes</a> for information.</p>
</div>
<div class="paragraph">
<p>Unlike Spring Boot 1.2, Spring Boot 1.3 no longer uses the <a href="https://docs.gradle.org/current/userguide/application_plugin.html">Gradle Application Plugin</a> so if you relied on any behavior the application plugin then the plugin will need to be re-applied to your <code>build.gradle</code>.</p>
</div>
<div class="paragraph">
<p>Spring Boot 1.3 also uses Spring Security 4.x by default, so if you project depends on Spring Security 3.x you have to force a downgrade. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.security:spring-security-core:3.2.9.RELEASE</span><span class="delimiter">'</span></span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.security:spring-security-web:3.2.9.RELEASE</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_run_task_no_longer_available_by_default">Gradle run task no longer available by default</h4>
<div class="paragraph">
<p>Because the Gradle <code>run</code> task for application startup was provided by the <a href="https://docs.gradle.org/current/userguide/application_plugin.html">Gradle Application Plugin</a> (see above), it is no longer available by default. If you use Gradle to start up your application, use the <code>bootRun</code> task instead, or re-apply the Application plugin in your <code>build.gradle</code>.</p>
</div>
<div class="paragraph">
<p>Note: If you don&#8217;t have need of the Gradle Application plugin&#8217;s features, but have custom Gradle tasks or IDE configurations that depend on <code>run</code>, you can supply your own <code>run</code> task that depends on <code>bootRun</code> in your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task run(<span class="key">dependsOn</span>: [<span class="string"><span class="delimiter">'</span><span class="content">bootRun</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_resource_annotation_defaults_to_json_instead_of_xml">Resource annotation defaults to JSON instead of XML</h4>
<div class="paragraph">
<p>The <a href="http://docs.grails.org/1.0.0.BUILD-SNAPSHOT/api/grails/rest/Resource.html">Resource</a> annotation applied to domain classes defaults to XML in Grails 3.0.x, but in Grails 3.1.x and above it defaults to JSON.</p>
</div>
<div class="paragraph">
<p>If you use this annotation with the expecation of produces XML responses as the default you can modify the definition as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(formats=[<span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">MyDomainClass</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will restore the Grails 3.0.x behavior.</p>
</div>
</div>
<div class="sect3">
<h4 id="_geb_and_htmlunit_2_18">Geb and HTMLUnit 2.18</h4>
<div class="paragraph">
<p>If you use Geb with HTMLUnit (something that is not recommended, as a more native driver such as PhantomJS is recommended) you will need to upgrade your dependencies in <code>build.grade</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testRuntime <span class="string"><span class="delimiter">'</span><span class="content">org.seleniumhq.selenium:selenium-htmlunit-driver:2.47.1</span><span class="delimiter">'</span></span>
    testRuntime <span class="string"><span class="delimiter">'</span><span class="content">net.sourceforge.htmlunit:htmlunit:2.18</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there are also some changes in behavior in HTMLUnit 2.18 that may cause issues in existing tests including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expressions that evaluate the title (Example <code>$('title')</code>) now return blank and should be replaced with just <code>title</code></p>
</li>
<li>
<p>If you return plain text in a response without surrounding HTML tags, these are no longer regarded as valid responses and should be wrapped in the required tags.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__code_application_groovy_code_changes_3_1_11"><code>application.groovy</code> Changes (3.1.11+)</h4>
<div class="paragraph">
<p>An improvement was added to make groovy configuration behave like yml configuration when it comes to the CLI. Previously, configuration values in <code>application.groovy</code> were not available to commands like <code>grails create-controller</code>. A side effect of this change causes an exception when those commands are executed if the configuration relies on classes in the runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="exception">Error</span> occurred running Grails <span class="key">CLI</span>: startup <span class="key">failed</span>:
script14738267015581837265078.groovy: <span class="integer">13</span>: unable to resolve <span class="type">class</span> <span class="class">com</span>.foo.Bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution is to create a separate file called <code>runtime.groovy</code> in <code>grails-app/conf</code>. That file will not be parsed by the CLI and will only be included at runtime.</p>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
