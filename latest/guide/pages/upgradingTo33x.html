<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.2 Upgrading to Grails 3.3 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Upgrading Grails Applications
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/versions.html"><strong>1</strong><span>Comparing Versions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>2</strong><span>Upgrading</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>2.2 Upgrading to Grails 3.3</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="upgradingTo33x">2.2 Upgrading to Grails 3.3</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgradingTo33x.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.3 includes several changes to dependencies and Event publishing that may require changes to your application if you are upgrading from Grails 3.2.x.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For information on upgrading from versions of Grails prior to Grails 3.2.x, see the <a href="http://docs.grails.org/3.2.x/guide/upgrading.html">Grails 3.2.x documentation on upgrading</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_gorm_6_1_upgrade">GORM 6.1 Upgrade</h3>
<div class="paragraph">
<p>GORM 6.1 <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#upgradeNotes">includes changes</a> that may require you to change your application.</p>
</div>
<div class="sect3">
<h4 id="_gorm_async_now_optional">GORM Async Now Optional</h4>
<div class="paragraph">
<p>Notably <code>grails-datastore-gorm-async</code> is now optional and if you use the <code>task</code> method of GORM you will need to manually implement the <code>AsyncEntity</code> trait.</p>
</div>
</div>
<div class="sect3">
<h4 id="_domain_autowiring_disabled">Domain Autowiring Disabled</h4>
<div class="paragraph">
<p>Domain class autowiring is disabled by default due to its impact on performance. You can re-enable autowiring for all domains using the <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#_the_default_mapping_constraints">Default Mapping</a> setting:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.gorm.default.mapping = {
        autowire <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can turn it on only for one domain class:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Book.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    BookService bookService

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> mapping {
       autowire <span class="predefined-constant">true</span>
    }
    ...
    ..
    .
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_flush_mode_now_commit_by_default">Flush Mode now COMMIT by Default</h4>
<div class="paragraph">
<p>The default flush mode has been change to <code>COMMIT</code> due to the impact the previous flush mode <code>AUTO</code> has on read performance. You can switch back to <code>AUTO</code> use the <code>hibernate.flush.mode</code> setting in <code>application.yml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_transactionmanager_chaining_for_multiple_data_sources_disabled_by_default">TransactionManager Chaining for Multiple Data Sources Disabled by Default</h4>
<div class="paragraph">
<p>In previous versions of Grails for multiple data sources a best effort transaction chain was used to attempt to manage a transaction across all configured data sources.</p>
</div>
<div class="paragraph">
<p>As of Grails 3.3 this is disabled as it caused confusion since it isn&#8217;t a true XA implementation and also impacts performance as for every transaction you have a transaction for each data source bound regardless if that is the actual requirement.</p>
</div>
<div class="paragraph">
<p>If your application depends on this feature you can re-enable it with the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
  <span class="key">transaction</span>:
    <span class="key">chainedTransactionManager</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">blacklistPattern</span>: <span class="string"><span class="content">'.*'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tomcat_jdbc">Tomcat JDBC</h4>
<div class="paragraph">
<p>GORM 6.1 and above now supports multiple connection pool options, so the <code>tomcat-jdbc</code> dependency is now optional. If you are upgrading you may need to add it (or another pool implementation) to your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">'</span><span class="content">org.apache.tomcat:tomcat-jdbc</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__testmixin_testfor_etc_deprecated">@TestMixin, @TestFor etc. Deprecated</h3>
<div class="paragraph">
<p>Since Grails 3.3, the <a href="https://testing.grails.org">Grails Testing Support Framework</a> is used for all unit tests. The new testing framework is much simpler and provides a set of traits that improve readability, debugging and code completion. An example hello world test can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.testing.web.controllers.ControllerUnitTest</span>

<span class="type">class</span> <span class="class">HelloControllerTests</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ControllerUnitTest&lt;HelloController&gt; {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test message action</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The message action is invoked</span><span class="delimiter">&quot;</span></span>
        controller.message()

        <span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello is returned</span><span class="delimiter">&quot;</span></span>
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on writing tests with Grails Testing Support see the <a href="https://testing.grails.org">dedicated documentation</a>.</p>
</div>
<div class="paragraph">
<p>To simplify upgrades you can can still use the previous AST transformation based framework by adding the following dependency to your Grails application:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-test-mixins:3.3.0</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_default_logger_name">Default Logger Name</h3>
<div class="paragraph">
<p>In previous versions of Grails, if you did not specify a logger in the controller, service, etc, a <code>log</code> variable was injected for you. The naming convention of that logger was <code>grails.app.${artefactType}.package.class</code>. For example:</p>
</div>
<div class="paragraph">
<p><code>grails.app.controllers.foo.bar.MyController</code></p>
</div>
<div class="paragraph">
<p>To make the logger names more intuitive as well as to increase consistency between custom code, plugin dependencies, and third party libraries, the <code>grails.app.${artefactType}</code> convention was removed. The same class as above will now be referenced the same way as any standard class. The way the <code>log</code> variable gets injected was also changed to defer to the Slf4j transformation. That means it is no longer necessary to check <code>if (log.isDebugEnabled())</code>.</p>
</div>
<div class="paragraph">
<p>The downside of this change is that it isn&#8217;t immediately simple to set up the same logging configuration for all controllers, for example. We think this can be solved with a package naming strategy that represents what your requirements are.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_alterations">Dependency Alterations</h3>
<div class="paragraph">
<p>In an effort to trim the size of the produced WAR file by Grails several dependencies are no longer resolved transtively including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commons-lang</code></p>
</li>
<li>
<p><code>gson</code></p>
</li>
<li>
<p><code>aspectjweaver</code></p>
</li>
<li>
<p><code>aspectjrt</code></p>
</li>
<li>
<p><code>ehcache</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are upgrading and have referenced any of these dependencies in your application you may need to alter your build to reference them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot_1_5_x">Spring Boot 1.5.x</h3>
<div class="paragraph">
<p>Spring Boot 1.5.x removes a number of deprecated classes, notably all of the classes within the <code>org.springframework.boot.context.embedded</code> package.</p>
</div>
<div class="paragraph">
<p>If your application is referencing any of the classes within this package you will need to alter your imports to use <code>org.springframework.boot.web.servlet</code> instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reactor_2_x_deprecated_and_removed">Reactor 2.x Deprecated and Removed</h3>
<div class="paragraph">
<p>Since Reactor 2.x is no longer being maintained and a new <a href="{asyncdocs}">EventBus</a> abstraction has been implemented, Reactor 2.x and all its dependencies have been removed.</p>
</div>
<div class="paragraph">
<p>A compatibility layer has been provided to allow classes compiled with the previous version that uses Reactor to run, however all plugins and application code should be re-compiled and direct references to Reactor 2.x should be removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_externalized_plugins">Externalized Plugins</h3>
<div class="paragraph">
<p>Several plugins and libraries have been separated from Grails core into standalone projects. The following table summarizes the previous artefact id, the new artefact id and the location of the new sources:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Externalized Plugins</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Previous Artefact ID</th>
<th class="tableblock halign-left valign-top">New Artefact ID</th>
<th class="tableblock halign-left valign-top">Sources</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-plugin-gsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins:gsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grails/grails-gsp" class="bare">https://github.com/grails/grails-gsp</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-plugin-converters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins:converters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grails-plugins/grails-plugin-converters" class="bare">https://github.com/grails-plugins/grails-plugin-converters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-plugin-async</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins:async</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grails/grails-async" class="bare">https://github.com/grails/grails-async</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-plugin-events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins:events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grails/grails-async" class="bare">https://github.com/grails/grails-async</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-plugin-testing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails:grails-test-mixins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grails-plugins/grails-test-mixin-plugin" class="bare">https://github.com/grails-plugins/grails-test-mixin-plugin</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_new_cache_plugin">New Cache Plugin</h3>
<div class="paragraph">
<p>The Cache plugin has been re-written to no longer use Spring proxies but AST transformations instead.</p>
</div>
<div class="paragraph">
<p>This improves startup and runtime performance, however one caveat is controller action response caching is no longer supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="_grails_domain_class_api_deprecated">Grails Domain Class API Deprecated</h3>
<div class="paragraph">
<p>The legacy classes that represent domain classes and their properties have been deprecated in favor of the mapping context API.</p>
</div>
<div class="paragraph">
<p>The reason for this is to avoid duplicate parsing of the same class data between GORM and Grails and reduce overall startup time.</p>
</div>
<div class="paragraph">
<p>The internal implementation of the methods in those classes now delegates to the mapping context. Due to that change, information about your domain classes is not available until the application context is available.</p>
</div>
<div class="paragraph">
<p>In previous versions of Grails it was possible to access <a href="../api/grails/core/GrailsDomainClass.html">GrailsDomainClass</a> instances and inspect the <a href="../api/grails/core/GrailsDomainClassProperty.html">GrailsDomainClassProperty</a> properties inside of the <code>doWithSpring</code> method in a plugin, for example.</p>
</div>
<div class="paragraph">
<p>If you have code that follows that example, an error will be thrown that looks like "The method &#8230;&#8203; cannot be accessed before GORM has initialized". The solution is to move any logic that executes before the context is available to somewhere else that executes after the context is available.</p>
</div>
<div class="paragraph">
<p>All code that uses the <a href="../api/grails/core/GrailsDomainClass.html">GrailsDomainClass</a> or <a href="../api/grails/core/GrailsDomainClassProperty.html">GrailsDomainClassProperty</a> classes should be re-written to use the mapping context api.</p>
</div>
<div class="paragraph">
<p>To get started, inject the <code>grailsDomainClassMappingContext</code> bean. See the api documentation for more information on the <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/MappingContext.html">MappingContext</a>, <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/PersistentEntity.html">PersistentEntity</a> (GrailsDomainClass), and <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/PersistentProperty.html">PersistentProperty</a> (GrailsDomainClassProperty).</p>
</div>
<div class="paragraph">
<p>The following table summarizes the deprecations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Deprecated Grails Domain Class API</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Class or Interface</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/core/GrailsDomainClass.html">GrailsDomainClass</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/PersistentEntity.html">PersistentEntity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/core/GrailsDomainClassProperty.html">GrailsDomainClassProperty</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/PersistentProperty.html">PersistentProperty</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>GrailsDomainClassProperty</code> interface had many more methods to evaluate the type of the property such as <code>isOneToOne</code>, <code>isOneToMany</code> etc. and while <code>PersistentProperty</code> does not provide direct equivalents you can use <code>instanceof</code> as a replacement using one of the subclasses found in the <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/model/types/package-summary.html">org.grails.datastore.mapping.model.types</a> package.</p>
</div>
<div class="paragraph">
<p>The following table summarizes this:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Deprecated GrailsDomainClassProperty method replacements</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Class or Interface</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAssociation()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof Association</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isOneToOne()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof OneToOne</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isManyToOne()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof ManyToOne</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isEmbedded()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof Embedded</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isManyToMany()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof ManyToMany</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isBasicCollectionType()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>property instanceof Basic</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_grails_validator_and_constrainedproperty_api_deprecated">Grails Validator and ConstrainedProperty API Deprecated</h3>
<div class="paragraph">
<p>Grails' previous validation API (part of the <code>grails.validation</code> package) has been externalized into a separate project not part of the <code>grails-datastore-gorm-validation</code> dependency.</p>
</div>
<div class="paragraph">
<p>This means that some interfaces previously part of Grails core are deprecated and the replacment in the external project should be used, including:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Deprecated Grails Validator Classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Class or Interface</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/validation/GrailsDomainClassValidator.html">GrailsDomainClassValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/validation/PersistentEntityValidator.html">PersistentEntityValidator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/validation/CascadingValidator.html">CascadingValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/validation/CascadingValidator.html">CascadingValidator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/validation/ConstrainedProperty.html">ConstrainedProperty</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/validation/ConstrainedProperty.html">ConstrainedProperty</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/validation/Constraint.html">Constraint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/validation/Constraint.html">Constraint</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/validation/AbstractConstraint.html">AbstractConstraint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//org/grails/datastore/gorm/validation/constraints/AbstractConstraint.html">AbstractConstraint</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally all classes within the <code>org.grails.validation</code> package are now deprecated.</p>
</div>
<div class="paragraph">
<p>To register a custom constraint you should now use the <a href="http://gorm.grails.org/latest/api//org/grails/datastore/gorm/validation/constraints/registry/ConstraintRegistry.html">ConstraintRegistry</a> interface instead.</p>
</div>
<div class="paragraph">
<p>The default <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/validation/ValidatorRegistry.html">ValidatorRegistry</a> implements the <code>ConstraintRegistry</code> interface and can be autowired into any controller or service by declaring the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ValidatorRegistry gormValidatorRegistry
...
gormValidatorRegistry.addConstraint(MyConstraint)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grails_transactional_ast_transforms_deprecated">Grails' Transactional AST Transforms Deprecated</h3>
<div class="paragraph">
<p>The transaction management AST transforms that shipped as part of Grails have been ported to GORM and improved to make it possible to use them outside of Grails.</p>
</div>
<div class="paragraph">
<p>With this in mind Grails' versions of <code>@Transactional</code> and <code>@Rollback</code> found within the <code>grails.transaction</code> package have been deprecated in favour of GORMs versions. You should change your imports to use the GORM version instead of the Grails version.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the deprecated classes and their replacements:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Deprecated Grails Transaction Transforms</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Class or Interface</th>
<th class="tableblock halign-left valign-top">Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/transaction/Transactional.html">grails.transaction.Transactional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/transactions/Transactional.html">grails.gorm.transactions.Transactional</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/transaction/Rollback.html">grails.transaction.Rollback</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/transactions/Rollback.html">grails.gorm.transactions.Rollback</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/grails/transaction/NotTransactional.html">grails.transaction.NotTransactional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/api//grails/gorm/transactions/NotTransactional.html">grails.gorm.transactions.NotTransactional</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_spring_proxies_for_services_no_longer_supported">Spring Proxies for Services No Longer Supported</h3>
<div class="paragraph">
<p>Earlier versions of Grails supported the use of Spring proxies for transaction management, but this support was disabled by default in Grails 3.2.x and developers encouraged to use the <code>@Transactional</code> AST transforms instead.</p>
</div>
<div class="paragraph">
<p>In Grails 3.3 the support for Spring proxies has been dropped completely and you must use Grails' AST transforms.</p>
</div>
<div class="paragraph">
<p>If you wish to continue to use Spring proxies for transaction management you will have to configure them manually use the appropriate Spring configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_datasource_plugin_refactor">Datasource Plugin Refactor</h3>
<div class="paragraph">
<p>In previous versions of Grails and GORM the multiple data sources support relied on Grails' data sources plugin. The logic for configuring multiple data sources has moved to GORM and as a result of major changes to the dataSources plugin, beans for the lazy and unproxied representation of a dataSource are no longer available.</p>
</div>
<div class="paragraph">
<p>The beans include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dataSourceUnproxied</code></p>
</li>
<li>
<p><code>dataSourceLazy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are referencing these beans you will need to remove these references and unwrap the single <code>dataSource</code> proxy manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="_task_groups">Task Groups</h3>
<div class="paragraph">
<p>Several tasks have had their groups changed to better reflect their purpose. If you&#8217;re having trouble finding a task, look through the different groups.</p>
</div>
</div>
<div class="sect2">
<h3 id="_legacy_json_builder_option_removed">Legacy JSON Builder Option Removed</h3>
<div class="paragraph">
<p>In a previous version of Grails, the JSON builder used by default for rendering JSON inline was changed. The previous behavior of using converters to build the JSON was able to be re-enabled by setting <code>grails.json.legacy.builder</code> to true. In Grails 3.3 that setting has been removed and it is no longer possible to use the legacy converter API to render JSON inline via the <code>render</code> method.</p>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
