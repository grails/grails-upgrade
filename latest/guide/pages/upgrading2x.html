<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.6 Upgrading from Grails 2.x 1.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Upgrading Grails Applications
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/versions.html"><strong>1</strong><span>Comparing Versions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>2</strong><span>Upgrading</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>2.6 Upgrading from Grails 2.x</h1>

                    <p><strong>Version:</strong> 1.0.0.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#upgradingPlugins"><strong>2.1</strong><span>Upgrading Plugins</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#upgradingApps"><strong>2.2</strong><span>Upgrading Applications</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#upgradingGeneral"><strong>2.3</strong><span>General Changes to be aware of when migrating apps</span></a>
                    </div>
                    
                </div>
                

                

<h2 id="upgrading2x">2.6 Upgrading from Grails 2.x</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading2x.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.0 is a complete ground up rewrite of Grails and introduces new concepts and components for many parts of the framework.</p>
</div>
<div class="paragraph">
<p>When upgrading an application or plugin from Grails 3.0 there are many areas to consider including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Removal of dynamic scaffolding from Grails 3.0.0 till 3.0.4 when it was re-introduced</p>
</li>
<li>
<p>Removal of before and after interceptors</p>
</li>
<li>
<p>Project structure differences</p>
</li>
<li>
<p>File location differences</p>
</li>
<li>
<p>Configuration differences</p>
</li>
<li>
<p>Package name differences</p>
</li>
<li>
<p>Legacy Gant Scripts</p>
</li>
<li>
<p>Gradle Build System</p>
</li>
<li>
<p>Changes to Plugins</p>
</li>
<li>
<p>Source vs Binary Plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The best approach to take when upgrading a plugin or application (and if your application is using several plugins the plugins will need upgrading first) is to create a new Grails 3.0 application of the same name and copy the source files into the correct locations in the new application.</p>
</div>
<div class="sect2">
<h3 id="_removal_of_before_and_after_interceptors">Removal of before and after interceptors</h3>
<div class="paragraph">
<p>Before and after interceptors were removed. So all <code>beforeInterceptor</code> and <code>afterInterceptor</code> need to be replaced by Stand alone interceptors.</p>
</div>
<div class="sect3">
<h4 id="_file_location_differences">File Location Differences</h4>
<div class="paragraph">
<p>The location of certain files have changed or been replaced with other files in Grails 3.0. The following table lists old default locations and their respective new locations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Old Location</strong></th>
<th class="tableblock halign-left valign-top"><strong>New Location</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/BuildConfig.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build.gradle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build time configuration is now defined in a Gradle build file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/Config.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/application.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renamed for consistency with Spring Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/UrlMappings.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/controllers/UrlMappings.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved since grails-app/conf is not a source directory anymore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/BootStrap.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/init/BootStrap.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved since grails-app/conf is not a source directory anymore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scripts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/main/scripts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/main/groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/main/groovy</code> (yes, groovy!)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test/unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/test/groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test/integration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/integration-test/groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/main/webapp</code> or <code>src/main/resources/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moved for consistency with Gradle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\*GrailsPlugin.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/main/groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin descriptor moved to a source directory</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>src/main/resources/public</code> is recommended as <code>src/main/webapp</code> only gets included in WAR packaging but not in JAR packaging.</p>
</div>
<div class="paragraph">
<p>It is recommended to merge Java source files from <code>src/java</code> into <code>src/main/groovy</code>. You can create a <code>src/main/java</code> directory if you want to and it will be used but it is generally better to combine the folders. (The Groovy and Java sources compile together.)</p>
</div>
<div class="paragraph">
<p>For plugins the plugin descriptor (a Groovy file ending with "GrailsPlugin") which was previously located in the root of the plugin directory should be moved to the <code>src/main/groovy</code> directory under an appropriate package.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_files_not_present_in_grails_2_x">New Files Not Present in Grails 2.x</h4>
<div class="paragraph">
<p>The reason it is best to create a new application and copy your original sources to it is because there are a number of new files that are not present in Grails 2.x by default. These include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build.gradle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Gradle build descriptor located in the root of the project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gradle.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties file defining the Grails and Gradle versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/logback.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging previously defined in <code>Config.groovy</code> is now defined using Logback</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/application.yml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration can now also be defined using YAML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/init/PACKAGE_PATH/Application.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>Application</code> class used By Spring Boot to start the application</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_files_not_present_in_grails_3_x">Files Not Present in Grails 3.x</h4>
<div class="paragraph">
<p>Some files that were previously created by Grails 2.x are no longer created. These have either been removed or an appropriate replacement added. The following table lists files no longer in use:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application version is now defined in <code>build.gradle</code>. The application name defaults to the directory name which can be overridden by creating a <code>settings.gradle</code> file and setting the <code>rootProject.name</code> property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails-app/conf/DataSource.groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merged together into <code>application.yml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependency resolution should be used to resolve JAR files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web-app/WEB-INF/applicationContext.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed. Beans can be defined in <code>grails-app/conf/spring/resources.groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>src/templates/war/web.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grails 3.0 no longer requires web.xml. Customizations can be done via Spring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web-app/WEB-INF/sitemesh.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed. Sitemesh filter no longer present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web-app/WEB-INF/tld</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed. Can be restored in <code>src/main/webapp</code> or <code>src/main/resources/WEB-INF</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This guide takes you through the fundamentals of upgrading a Grails 2.x application or plugins to Grails 3.x.</p>
</div>
</div>
</div>


<h2 id="upgradingPlugins">2.6.1 Upgrading Plugins</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading2x/upgradingPlugins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To upgrade a Grails 2.x plugin to Grails 3.x you need to make a number of different changes. This documentation will outline the steps that were taken to upgrade the Quartz plugin to Grails 3, each individual plugin may differ.</p>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_new_grails_3_plugin">Step 1 - Create a new Grails 3 plugin</h4>
<div class="paragraph">
<p>The first step is to create a new Grails 3 plugin using the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-plugin quartz</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a Grails 3 plugin in the <code>quartz</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_copy_sources_from_the_original_grails_2_plugin">Step 2 - Copy sources from the original Grails 2 plugin</h4>
<div class="paragraph">
<p>The next step is to copy the sources from the original Grails 2 plugin to the Grails 3 plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># first the sources
cp -rf ../quartz-2.x/src/groovy/ src/main/groovy
cp -rf ../quartz-2.x/src/java/ src/main/groovy
cp -rf ../quartz-2.x/grails-app/ grails-app
cp -rf ../quartz-2.x/QuartzGrailsPlugin.groovy src/main/groovy/grails/plugins/quartz

# then the tests
cp -rf ../quartz-2.x/test/unit/* src/test/groovy
mkdir -p src/integration-test/groovy
cp -rf ../quartz-2.x/test/integration/* src/integration-test/groovy

# then templates / other resources
cp -rf ../quartz-2.x/src/templates/ src/main/templates</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_alter_the_plugin_descriptor">Step 3 - Alter the plugin descriptor</h4>
<div class="paragraph">
<p>You will need to add a package declaration to the plugin descriptor. In this case <code>QuartzGrailsPlugin</code> is modified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// add package declaration</span>
<span class="keyword">package</span> grails.plugins.quartz
...
class QuartzGrailsPlugin <span class="directive">extends</span> Plugin {
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition you should remove the <code>version</code> property from the descriptor as this is now defined in <code>build.gradle</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_4_update_the_gradle_build_with_required_dependencies">Step 4 - Update the Gradle build with required dependencies</h4>
<div class="paragraph">
<p>The repositories and dependencies defined in <code>grails-app/conf/BuildConfig.groovy</code> of the original Grails 2.x plugin will need to be defined in <code>build.gradle</code> of the new Grails 3.x plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.quartz-scheduler:quartz:2.2.1</span><span class="delimiter">&quot;</span></span>) {
    exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">slf4j-api</span><span class="delimiter">'</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">'</span><span class="content">c3p0</span><span class="delimiter">'</span></span>
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended to use the latest stable, Grails 3+ compatible version of plugins. (Grails 2.x plugin versions will not work.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_5_modify_package_imports">Step 5 - Modify Package Imports</h4>
<div class="paragraph">
<p>In Grails 3.x all internal APIs can be found in the <code>org.grails</code> package and public facing APIs in the <code>grails</code> package. The <code>org.codehaus.groovy.grails</code> package no longer exists.</p>
</div>
<div class="paragraph">
<p>All package declaration in sources should be modified for the new location of the respective classes. Example <code>org.codehaus.groovy.grails.commons.GrailsApplication</code> is now <code>grails.core.GrailsApplication</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_5_migrate_plugin_specific_config_to_application_yml">Step 5 - Migrate Plugin Specific Config to application.yml</h4>
<div class="paragraph">
<p>Some plugins define a default configuration file. For example the Quartz plugin defines a file called <code>grails-app/conf/DefaultQuartzConfig.groovy</code>. In Grails 3.x this default configuration can be migrated to <code>grails-app/conf/application.yml</code> and it will automatically be loaded by Grails without requiring manual configuration merging.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_6_update_plugin_exclusions">Step 6 - Update plugin exclusions</h4>
<div class="paragraph">
<p>Old plugins may have a <code>pluginExcludes</code> property defined that lists the patterns for any files that should not be included in the plugin package. This is normally used to exclude artifacts such as domain classes that are used in the plugin&#8217;s integration tests. You generally don&#8217;t want these polluting the target application.</p>
</div>
<div class="paragraph">
<p>This property is no longer sufficient in Grails 3, and nor can you use source paths. Instead, you must specify patterns that match the paths of the compiled classes. For example, imagine you have some test domain classes in the <code>grails-app/domain/plugin/tests</code> directory. You should first change the <code>pluginExcludes</code> value to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> pluginExcludes = [<span class="string"><span class="delimiter">&quot;</span><span class="content">plugin/test/**</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then add this block to the build file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
    exclude <span class="string"><span class="delimiter">&quot;</span><span class="content">plugin/test/**</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The easiest way to ensure these patterns work effectively is to put all your non-packaged class into a distinct Java package so that there is a clean separation between the main plugin classes and the rest.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_7_register_artefacthandler_definitions">Step 7 - Register ArtefactHandler Definitions</h4>
<div class="paragraph">
<p>In Grails 3.x <a href="http://docs.grails.org/1.0.0.BUILD-SNAPSHOT/api/grails/core/ArtefactHandler.html">ArtefactHandler</a> definitions written in Java need to be declared in a file called <code>src/main/resources/META-INF/grails.factories</code> since these need to be known at compile time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <code>ArtefactHandler</code> is written in Groovy this step can be skipped as Grails will automatically create the <code>grails.factories</code> file during compilation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Quartz plugin requires the following definition to register the <code>ArtrefactHandler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.core.ArtefactHandler=grails.plugins.quartz.JobArtefactHandler</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_8_migrate_code_generation_scripts">Step 8 - Migrate Code Generation Scripts</h4>
<div class="paragraph">
<p>Many plugins previously defined command line scripts in Gant. In Grails 3.x command line scripts have been replaced by two new features: Code generation scripts and Gradle tasks.</p>
</div>
<div class="paragraph">
<p>If your script is doing simple code generation then for many cases a code generation script can replace an old Gant script.</p>
</div>
<div class="paragraph">
<p>The <code>create-job</code> script provided by the Quartz plugin in Grails 2.x was defined in <code>scripts/CreateJob.groovy</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">includeTargets &lt;&lt; grailsScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">_GrailsCreateArtifacts</span><span class="delimiter">&quot;</span></span>)

target(<span class="key">createJob</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Creates a new Quartz scheduled job</span><span class="delimiter">&quot;</span></span>) {
    depends(checkVersion, parseArguments)

    <span class="keyword">def</span> type = <span class="string"><span class="delimiter">&quot;</span><span class="content">Job</span><span class="delimiter">&quot;</span></span>
    promptForName(<span class="key">type</span>: type)

    <span class="keyword">for</span> (name <span class="keyword">in</span> argsMap.params) {
        name = purgeRedundantArtifactSuffix(name, type)
        createArtifact(<span class="key">name</span>: name, <span class="key">suffix</span>: type, <span class="key">type</span>: type, <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">grails-app/jobs</span><span class="delimiter">&quot;</span></span>)
        createUnitTest(<span class="key">name</span>: name, <span class="key">suffix</span>: type)
    }
}

setDefaultTarget <span class="string"><span class="delimiter">'</span><span class="content">createJob</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A replacement Grails 3.x compatible script can be created using the <code>create-script</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-script create-job</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which creates a new script called <code>src/main/scripts/create-job.groovy</code>. Using the new code generation API it is simple to implement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">description(<span class="string"><span class="delimiter">&quot;</span><span class="content">Creates a new Quartz scheduled job</span><span class="delimiter">&quot;</span></span>) {
    usage <span class="string"><span class="delimiter">&quot;</span><span class="content">grails create-job &lt;&lt;JOB NAME&gt;&gt;</span><span class="delimiter">&quot;</span></span>
    argument <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">Job Name</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The name of the job</span><span class="delimiter">&quot;</span></span>
}

model = model( args[<span class="integer">0</span>] )
render  <span class="key">template</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Job.groovy</span><span class="delimiter">&quot;</span></span>,
        <span class="key">destination</span>: file( <span class="string"><span class="delimiter">&quot;</span><span class="content">grails-app/jobs/</span><span class="inline"><span class="inline-delimiter">$</span>model</span><span class="content">.packagePath/</span><span class="inline"><span class="inline-delimiter">${</span>model.simpleName<span class="inline-delimiter">}</span></span><span class="content">Job.groovy</span><span class="delimiter">&quot;</span></span>),
        <span class="key">model</span>: model</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the documentation on <a href="commandLine.html#creatingCustomScripts">Creating Custom Scripts</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_more_complex_scripts_using_gradle_tasks">Migrating More Complex Scripts Using Gradle Tasks</h4>
<div class="paragraph">
<p>Using the old Grails 2.x build system it was relatively common to spin up Grails inside the command line. In Grails 3.x it is not possible to load a Grails application within a code generation script created by the <a href="../ref/Command%20Line/create-script.html">create-script</a> command.</p>
</div>
<div class="paragraph">
<p>Instead a new mechanism specific to plugins exists via the <a href="../ref/Command%20Line/create-command.html">create-command</a> command. The <code>create-command</code> command will create a new <a href="http://docs.grails.org/1.0.0.BUILD-SNAPSHOT/api/grails/dev/commands/ApplicationCommand.html">ApplicationCommand</a>, for example the following command will execute a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.dev.commands.*</span>
<span class="keyword">import</span> <span class="include">javax.sql.*</span>
<span class="keyword">import</span> <span class="include">groovy.sql.*</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.*</span>

<span class="type">class</span> <span class="class">RunQueryCommand</span> <span class="directive">implements</span> ApplicationCommand {

  <span class="annotation">@Autowired</span>
  <span class="predefined-type">DataSource</span> dataSource

  <span class="type">boolean</span> handle(ExecutionContext ctx) {
      <span class="keyword">def</span> sql = <span class="keyword">new</span> Sql(dataSource)
      println sql.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from foo</span><span class="delimiter">&quot;</span></span>)
      <span class="keyword">return</span> <span class="predefined-constant">true</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this command in place once the plugin is installed into your local Maven cache you can add the plugin to both the build classpath and the runtime classpath of the application&#8217;s <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
  ...
  dependencies {
    classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:myplugin:0.1-SNAPSHOT</span><span class="delimiter">&quot;</span></span>
  }
}
...
dependencies {
  runtime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:myplugin:0.1-SNAPSHOT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails will automatically create a Gradle task called <code>runQuery</code> and a command named <code>run-query</code> so both the following examples will execute the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails run-query
$ gradle runQuery</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_8_delete_files_that_were_migrated_or_no_longer_used">Step 8 - Delete Files that were migrated or no longer used</h4>
<div class="paragraph">
<p>You should now delete and cleanup the project of any files no longer required by Grails 3.x (<code>BuildConfig.groovy</code>, <code>Config.groovy</code>, <code>DataSource.groovy</code> etc.)</p>
</div>
</div>


<h2 id="upgradingApps">2.6.2 Upgrading Applications</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading2x/upgradingApps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Upgrading applications to Grails 3.x will require that you upgrade all plugins the application uses first, hence you should follow the steps in the previous section to first upgrade your plugins.</p>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_new_application">Step 1 - Create a New Application</h4>
<div class="paragraph">
<p>Once the plugins are Grails 3.x compatible you can upgrade the application. To upgrade an application it is again best to create a new Grails 3 application using the "web" profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp
$ cd myapp</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_migrate_sources">Step 2 - Migrate Sources</h4>
<div class="paragraph">
<p>The next step is to copy the sources from the original Grails 2 application to the Grails 3 application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># first the sources
cp -rf ../old_app/src/groovy/ src/main/groovy
cp -rf ../old_app/src/java/ src/main/groovy
cp -rf ../old_app/grails-app/ grails-app

# then the tests
cp -rf ../old_app/test/unit/ src/test/groovy
mkdir -p src/integration-test/groovy
cp -rf ../old_app/test/integration/ src/integration-test/groovy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_update_the_gradle_build_with_required_dependencies">Step 3 - Update the Gradle build with required dependencies</h4>
<div class="paragraph">
<p>The repositories and dependencies defined in <code>grails-app/conf/BuildConfig.groovy</code> of the original Grails 2.x application will need to be defined in <code>build.gradle</code> of the new Grails 3.x application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_4_modify_package_imports">Step 4 - Modify Package Imports</h4>
<div class="paragraph">
<p>In Grails 3.x all internal APIs can be found in the <code>org.grails</code> package and public facing APIs in the <code>grails</code> package. The <code>org.codehaus.groovy.grails</code> package no longer exists.</p>
</div>
<div class="paragraph">
<p>All package declaration in sources should be modified for the new location of the respective classes. Example <code>org.codehaus.groovy.grails.commons.GrailsApplication</code> is now <code>grails.core.GrailsApplication</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_5_migrate_configuration">Step 5 - Migrate Configuration</h4>
<div class="paragraph">
<p>The configuration of the application will need to be migrated, this can normally be done by simply renaming <code>grails-app/conf/Config.groovy</code> to <code>grails-app/conf/application.groovy</code> and merging the content of <code>grails-app/conf/DataSource.groovy</code> into <code>grails-app/conf/application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>Note however that Log4j has been replaced by <code>grails-app/conf/logback.groovy</code> for logging, so any logging configuration in <code>grails-app/conf/Config.groovy</code> should be migrated to <a href="http://logback.qos.ch/manual/groovy.html">logback format</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_6_migrate_web_xml_modifications_to_spring">Step 6 - Migrate web.xml Modifications to Spring</h4>
<div class="paragraph">
<p>If you have a modified <code>web.xml</code> template then you will need to migrate this to Spring as Grails 3.x does not use a web.xml (although it is still possible to have on in <code>src/main/webapp/WEB-INF/web.xml</code>).</p>
</div>
<div class="paragraph">
<p>New servlets and filters can be registered as Spring beans or with <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/context/embedded/ServletRegistrationBean.html">ServletRegistrationBean</a> and <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/context/embedded/FilterRegistrationBean.html">FilterRegistrationBean</a> respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_7_migrate_static_assets_not_handled_by_asset_pipeline">Step 7 - Migrate Static Assets not handled by Asset Pipeline</h4>
<div class="paragraph">
<p>If you have static assets in your <code>web-app</code> directory of your Grails 2.x application such as HTML files, TLDs etc. these need to be moved. For public assets such as static HTML pages and so on these should go in <code>src/main/resources/public</code>.</p>
</div>
<div class="paragraph">
<p>TLD descriptors and non public assets should go in <code>src/main/resources/WEB-INF</code>.</p>
</div>
<div class="paragraph">
<p>As noted earlier, <code>src/main/webapp</code> folder can also be used for this purpose but it is not recommended.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_8_migrate_tests">Step 8 - Migrate Tests</h4>
<div class="paragraph">
<p>Once the package names are corrected unit tests will continue to run, however any tests that extend the deprecated and removed JUnit 3 hierarchy will need to be migrated to Spock or JUnit 4.</p>
</div>
<div class="paragraph">
<p>Integration tests will need to be annotated with the <a href="http://docs.grails.org/1.0.0.BUILD-SNAPSHOT/api/grails/test/mixin/integration/Integration.html">Integration</a> annotation and should not extend GroovyTestCase or any JUnit 3 super class.</p>
</div>
</div>


<h2 id="upgradingGeneral">2.6.3 General Changes to be aware of when migrating apps</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-upgrade/edit/master/src/main/docs/guide/upgrading/upgrading2x/upgradingGeneral.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are other miscellaneous changes between Grails 2.x and Grails 3.x that it may help to be aware of when migrating your applications and plugins. Minor changes may be required.</p>
</div>
<div class="sect3">
<h4 id="_domain_classes">Domain classes</h4>
<div class="paragraph">
<p>The <a href="#constraints">Constraints</a> section of a <a href="#GORM">Domain Class</a> (or other validateable object) looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  myField <span class="key">nullable</span>: <span class="predefined-constant">true</span>
  another <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Grails 2.x, fields with no constraints could be declared in the <a href="#constraints">Constraints</a> block, as a method call with no arguments. Example (NB. the following syntax is <strong>no longer</strong> supported):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  mySimpleProperty()                  <span class="comment">// &lt;- A field that has no constraints. This syntax is not supported in Grails 3.</span>
  anotherProperty <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A different syntax has to be used in Grails 3. Either remove the field declaration from the constraints block (if there are no constraints to specify for it), or to keep the field placeholder, pass an empty map argument: <code>\[:\]</code> instead of <code>()</code>.</p>
</div>
<div class="paragraph">
<p>Replacement code for Grails 3.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
  name <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
  mySimpleProperty [:]                <span class="comment">// &lt;- Empty map argument instead of ()</span>
  anotherProperty <span class="key">unique</span>: <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If such declarations have not yet been changed then a log message like this emits on startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ORM Mapping <span class="key">Invalid</span>: Specified config option &lt;&lt;mySimpleProperty&gt;&gt; does not exist <span class="keyword">for</span> <span class="type">class</span> [<span class="class">example</span>.MyDomainClass]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_project_builds_grails_2_x_inline_plugins">Multi-project builds (Grails 2.x inline plugins)</h4>
<div class="paragraph">
<p>If your project had inline plugins in Grails 2.x, contains ASTs, or if your project is composed of several modules or related applications then you may decide to restructure your project as a Gradle <strong>multi-project build</strong>.</p>
</div>
<div class="paragraph">
<p>Sample multi-project structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">+ example
    + example-app   &lt;-- Main app
    + example-core  &lt;-- Shared code plugin
    + example-ast   &lt;-- AST transformations plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>How to configure this is documented in the <a href="#plugins">Plugins</a> section under the heading 'Inline Plugins in Grails 3.0'.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_from_grails_2_x_to_grails_3_1">Migrating from Grails 2.x to Grails 3.1+</h4>
<div class="paragraph">
<p>During the progress of migrating code from Grails 2.4 to Grails 3.1+, your project (and the plugins that your project depends on) will be moving to GORM 5 (or higher) and other newer library versions. You might also wish to familiarise yourself with the differences mentioned in the section <a href="#upgrading3x">Upgrading from Grails 3.0</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ast_transformations">AST Transformations</h4>
<div class="paragraph">
<p>If your application contains AST transformations, please be aware that for these to be applied to your application code, they must now be contained <strong>within a plugin</strong>. (In Grails 2.x it was possible to pre-compile AST transformations then apply them to your application code by hooking into compile events in <code>_Events.groovy</code>. This is no longer possible. Move your AST Transformation classes and associated annotations into a plugin for this purpose.)</p>
</div>
<div class="paragraph">
<p>There are two AST patterns on which you can base migration of your AST transformer code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy way: Use Groovy AST transformation annotations.</p>
</li>
<li>
<p>Grails way: Use Grails AST transformer annotations.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_groovy_ast_transformations">Groovy AST transformations</h5>
<div class="ulist">
<ul>
<li>
<p>Import <code>org.codehaus.groovy.transform.GroovyASTTransformation</code></p>
</li>
<li>
<p>Annotate your transformation class with <code>GroovyASTTransformation(phase=CompilePhase.CANONICALIZATION)</code></p>
</li>
<li>
<p>A useful example app can be found here: <a href="#ref-comjeffbrowngrails3ast-grails3ast">grails3ast</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_grails_ast_transformations">Grails AST transformations</h5>
<div class="ulist">
<ul>
<li>
<p>Import <code>grails.compiler.ast.AstTransformer</code></p>
</li>
<li>
<p>Annotate your transformation class with <code>AstTransformer</code></p>
</li>
<li>
<p>Implement applicable interfaces, particularly if you are transforming Artefacts, e.g. <code>implements GrailsArtefactClassInjector, AnnotatedClassInjector</code></p>
</li>
<li>
<p>Your Transformer class must reside in a package under <strong>org.grails.compiler</strong>, otherwise it will not be detected. Example: <strong>org.grails.compiler.myapp</strong></p>
</li>
<li>
<p>Examples can be found in the Grails source code</p>
</li>
<li>
<p>Example reference: <a href="#ref-java-ControllerActionTransformer.java">ControllerActionTransformer.java</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deployment_to_containers">Deployment to containers</h4>
<div class="paragraph">
<p>Grails uses Spring Boot to embed a Tomcat or Jetty instance by default. To build a war file for deployment to a container you will need to make a simple change to <code>build.gradle</code> (so that a container is not embedded).</p>
</div>
<div class="paragraph">
<p>If you deploy to a Tomcat 7 container then there is an additional step. Grails 3 is built against Tomcat 8 APIs by default. You will need to change the target Tomcat version in the build to 7.</p>
</div>
<div class="paragraph">
<p>There are standalone deployment options available.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="#deployingAnApplication">Deployment guide</a> for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_datasources">Multiple datasources</h4>
<div class="paragraph">
<p>If your application uses multiple datasources, then be aware that the way these are declared in <code>application.yml</code> or <code>application.groovy</code> (previously <code>DataSources.groovy</code>) has changed.</p>
</div>
<div class="paragraph">
<p>If there is more than one DataSource in an application there is now a <code>dataSources { &#8230;&#8203; }</code> configuration block to contain them all. Previously, multiple <code>dataSource</code> declarations were used, with an underscore and suffix on the additional datasources, e.g. <code>dataSource_lookup { &#8230;&#8203; }</code>.</p>
</div>
<div class="paragraph">
<p>Please refer to the user guide section on <a href="#multipleDatasources">Multiple Datasources</a> for examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improvements_to_dependency_injection">Improvements to dependency injection</h4>
<div class="paragraph">
<p>In your Grails 2.x app you may have used Spring <code>@Autowired</code> in a few situations, such as dependency injection into certain base classes, and for typed field dependency injection. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span>
org.quartz.Scheduler quartzScheduler</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails now has support for dependency injection into typed fields in addition to untyped <code>def</code> fields, following the usual Grails conventions of field name matching the bean property name. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GrailsApplication grailsApplication</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may find that <code>@Autowired</code> no longer works as it did previously in your code on artefacts or base classes, in certain scenarios, resulting in NULL for these fields. Changing these to a simple typed Grails dependency following the Grails naming convention and removing <code>@Autowired</code> should resolve this.</p>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/versions.html">&lt;&lt; <strong>1</strong><span>Comparing Versions</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
